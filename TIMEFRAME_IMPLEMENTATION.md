# –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ç–∞–π–º—Ñ—Ä–µ–π–º–æ–≤ ‚Äî –ø–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è**: 2026-01-29  
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: 2026-01-29 (–¥–æ–±–∞–≤–ª–µ–Ω hard reset —á–µ—Ä–µ–∑ React key –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–∞)  
**–í–µ—Ä—Å–∏—è**: 1.2  
**–¶–µ–ª—å**: –ü–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –∏ –º–µ—Ö–∞–Ω–∏–∑–º–∞ —Ä–∞–±–æ—Ç—ã —Ç–∞–π–º—Ñ—Ä–µ–π–º–æ–≤ –≤ —Å–∏—Å—Ç–µ–º–µ

---

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–û–±–∑–æ—Ä –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã](#–æ–±–∑–æ—Ä-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã)
2. [–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ç–∞–π–º—Ñ—Ä–µ–π–º—ã](#–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ-—Ç–∞–π–º—Ñ—Ä–µ–π–º—ã)
3. [–ë—ç–∫–µ–Ω–¥: –∞–≥—Ä–µ–≥–∞—Ü–∏—è —Å–≤–µ—á–µ–π](#–±—ç–∫–µ–Ω–¥-–∞–≥—Ä–µ–≥–∞—Ü–∏—è-—Å–≤–µ—á–µ–π)
4. [–§—Ä–æ–Ω—Ç–µ–Ω–¥: –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–∞–π–º—Ñ—Ä–µ–π–º–∞](#—Ñ—Ä–æ–Ω—Ç–µ–Ω–¥-–ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ-—Ç–∞–π–º—Ñ—Ä–µ–π–º–∞)
5. [Timeframe-aware initial zoom](#timeframe-aware-initial-zoom) ‚≠ê **–ö–õ–Æ–ß–ï–í–û–ï –†–ï–®–ï–ù–ò–ï**
6. [Hard reset —á–µ—Ä–µ–∑ React key](#hard-reset-—á–µ—Ä–µ–∑-react-key) üî• **–ü–û–õ–ù–û–ï –ü–ï–†–ï–°–û–ó–î–ê–ù–ò–ï**
7. [–ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–∏](#–Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è-–≤—Ä–µ–º–µ–Ω–∏)
8. [Zoom —á–µ—Ä–µ–∑ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–≤–µ—á–µ–π](#zoom-—á–µ—Ä–µ–∑-–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ-—Å–≤–µ—á–µ–π)
9. [–ï–¥–∏–Ω—ã–π anchorTime](#–µ–¥–∏–Ω—ã–π-anchortime)
10. [–ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è](#–ø–æ–ª–Ω—ã–π-—Ü–∏–∫–ª-–ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è)
11. [–ü—Ä–∏–º–µ—Ä—ã —Ä–∞–±–æ—Ç—ã](#–ø—Ä–∏–º–µ—Ä—ã-—Ä–∞–±–æ—Ç—ã)

---

## üèóÔ∏è –û–±–∑–æ—Ä –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

### –ö–æ–Ω—Ü–µ–ø—Ü–∏—è

–°–∏—Å—Ç–µ–º–∞ —Ç–∞–π–º—Ñ—Ä–µ–π–º–æ–≤ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∞ –Ω–∞ –ø—Ä–∏–Ω—Ü–∏–ø–µ **–∞–≥—Ä–µ–≥–∞—Ü–∏–∏ –±–∞–∑–æ–≤—ã—Ö —Å–≤–µ—á–µ–π**:

- **–ë–∞–∑–æ–≤—ã–π —Ç–∞–π–º—Ñ—Ä–µ–π–º**: `5s` (5 —Å–µ–∫—É–Ω–¥) ‚Äî –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π —Ç–∞–π–º—Ñ—Ä–µ–π–º, –∫–æ—Ç–æ—Ä—ã–π –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é –∏–∑ —Ç–∏–∫–æ–≤ —Ü–µ–Ω—ã
- **–í—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ç–∞–π–º—Ñ—Ä–µ–π–º—ã**: –∞–≥—Ä–µ–≥–∏—Ä—É—é—Ç—Å—è –∏–∑ –±–∞–∑–æ–≤—ã—Ö `5s` —Å–≤–µ—á–µ–π
- **–ö—Ä–∞—Ç–Ω–æ—Å—Ç—å**: –í—Å–µ —Ç–∞–π–º—Ñ—Ä–µ–π–º—ã –∫—Ä–∞—Ç–Ω—ã 5 —Å–µ–∫—É–Ω–¥–∞–º (10s = 2√ó5s, 1m = 12√ó5s, –∏ —Ç.–¥.)

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    –ë–≠–ö–ï–ù–î                                   ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  CandleEngine (5s) ‚Üí TimeframeAggregator ‚Üí CandleStore     ‚îÇ
‚îÇ       ‚Üì                ‚Üì                      ‚Üì             ‚îÇ
‚îÇ   –ë–∞–∑–æ–≤—ã–µ —Å–≤–µ—á–∏    –ê–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ      –•—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î      ‚îÇ
‚îÇ                     —Å–≤–µ—á–∏ (10s-1d)                          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                          ‚Üì API
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    –§–†–û–ù–¢–ï–ù–î                                 ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  useTerminalSnapshot ‚Üí useChart ‚Üí useChartData             ‚îÇ
‚îÇ       ‚Üì                ‚Üì              ‚Üì                     ‚îÇ
‚îÇ   –ó–∞–≥—Ä—É–∑–∫–∞         –û—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è    –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è            ‚îÇ
‚îÇ   snapshot         –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤    –≤—Ä–µ–º–µ–Ω–∏                  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üìä –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ç–∞–π–º—Ñ—Ä–µ–π–º—ã

### –ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫

| –¢–∞–π–º—Ñ—Ä–µ–π–º | –°–µ–∫—É–Ω–¥—ã | –ö—Ä–∞—Ç–Ω–æ—Å—Ç—å –∫ 5s | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----------|---------|----------------|----------|
| `5s`      | 5       | 1√ó             | –ë–∞–∑–æ–≤—ã–π —Ç–∞–π–º—Ñ—Ä–µ–π–º (–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –∏–∑ —Ç–∏–∫–æ–≤) |
| `10s`     | 10      | 2√ó             | 2 –±–∞–∑–æ–≤—ã–µ —Å–≤–µ—á–∏ |
| `15s`     | 15      | 3√ó             | 3 –±–∞–∑–æ–≤—ã–µ —Å–≤–µ—á–∏ |
| `30s`     | 30      | 6√ó             | 6 –±–∞–∑–æ–≤—ã—Ö —Å–≤–µ—á–µ–π |
| `1m`      | 60      | 12√ó            | 12 –±–∞–∑–æ–≤—ã—Ö —Å–≤–µ—á–µ–π |
| `2m`      | 120     | 24√ó            | 24 –±–∞–∑–æ–≤—ã–µ —Å–≤–µ—á–∏ |
| `3m`      | 180     | 36√ó            | 36 –±–∞–∑–æ–≤—ã—Ö —Å–≤–µ—á–µ–π |
| `5m`      | 300     | 60√ó            | 60 –±–∞–∑–æ–≤—ã—Ö —Å–≤–µ—á–µ–π |
| `10m`     | 600     | 120√ó           | 120 –±–∞–∑–æ–≤—ã—Ö —Å–≤–µ—á–µ–π |
| `15m`     | 900     | 180√ó           | 180 –±–∞–∑–æ–≤—ã—Ö —Å–≤–µ—á–µ–π |
| `30m`     | 1800    | 360√ó           | 360 –±–∞–∑–æ–≤—ã—Ö —Å–≤–µ—á–µ–π |
| `1h`      | 3600    | 720√ó           | 720 –±–∞–∑–æ–≤—ã—Ö —Å–≤–µ—á–µ–π |
| `4h`      | 14400   | 2880√ó          | 2880 –±–∞–∑–æ–≤—ã—Ö —Å–≤–µ—á–µ–π |
| `1d`      | 86400   | 17280√ó         | 17280 –±–∞–∑–æ–≤—ã—Ö —Å–≤–µ—á–µ–π |

### –¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö

**–ë—ç–∫–µ–Ω–¥** (`backend/src/prices/PriceTypes.ts`):
```typescript
export type Timeframe = 
  | '5s' | '10s' | '15s' | '30s' 
  | '1m' | '2m' | '3m' | '5m' | '10m' | '15m' | '30m' 
  | '1h' | '4h' | '1d';
```

**–§—Ä–æ–Ω—Ç–µ–Ω–¥** (`frontend/app/terminal/page.tsx`):
```typescript
type Timeframe = 
  | '5s' | '10s' | '15s' | '30s' 
  | '1m' | '2m' | '3m' | '5m' | '10m' | '15m' | '30m' 
  | '1h' | '4h' | '1d';
```

---

## üîß –ë—ç–∫–µ–Ω–¥: –∞–≥—Ä–µ–≥–∞—Ü–∏—è —Å–≤–µ—á–µ–π

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∞–≥—Ä–µ–≥–∞—Ü–∏–∏

**–§–∞–π–ª**: `backend/src/prices/engines/TimeframeAggregator.ts`

#### 1. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Ç–∞–π–º—Ñ—Ä–µ–π–º–æ–≤

```typescript
const TIMEFRAME_SECONDS: Record<Timeframe, number> = {
  '5s': 5,
  '10s': 10,
  '15s': 15,
  '30s': 30,
  '1m': 60,
  '2m': 120,
  '3m': 180,
  '5m': 300,
  '10m': 600,
  '15m': 900,
  '30m': 1800,
  '1h': 3600,
  '4h': 14400,
  '1d': 86400,
};
```

#### 2. –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –±–∞–∑–æ–≤—ã–µ —Å–≤–µ—á–∏

```typescript
// –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ–º—Å—è –Ω–∞ –∑–∞–∫—Ä—ã—Ç–∏–µ –±–∞–∑–æ–≤—ã—Ö 5s —Å–≤–µ—á–µ–π
this.unsubscribeCandleClosed = this.eventBus.on('candle_closed', (event) => {
  const candle = event.data as Candle;
  if (candle.timeframe === '5s') {
    this.handleBaseCandle(candle); // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∫–∞–∂–¥—É—é –±–∞–∑–æ–≤—É—é —Å–≤–µ—á—É
  }
});
```

#### 3. –ü—Ä–æ—Ü–µ—Å—Å –∞–≥—Ä–µ–≥–∞—Ü–∏–∏

**–®–∞–≥ 1: –ü–æ–ª—É—á–µ–Ω–∏–µ –±–∞–∑–æ–≤–æ–π —Å–≤–µ—á–∏**
- –ü—Ä–∏—Ö–æ–¥–∏—Ç –∑–∞–∫—Ä—ã—Ç–∞—è `5s` —Å–≤–µ—á–∞ –∏–∑ `CandleEngine`
- –°–æ–¥–µ—Ä–∂–∏—Ç: `open`, `high`, `low`, `close`, `timestamp`

**–®–∞–≥ 2: –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ —Å–ª–æ—Ç–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∞–π–º—Ñ—Ä–µ–π–º–∞**

```typescript
private aggregateCandle(baseCandle: Candle, timeframe: Timeframe): void {
  const timeframeSeconds = TIMEFRAME_SECONDS[timeframe];
  
  // –í—ã—á–∏—Å–ª—è–µ–º –Ω–∞—á–∞–ª–æ –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ —Å–ª–æ—Ç–∞ –¥–ª—è —ç—Ç–æ–≥–æ —Ç–∞–π–º—Ñ—Ä–µ–π–º–∞
  // –ù–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è 30s: timestamp 1234567890 ‚Üí —Å–ª–æ—Ç –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å 1234567880
  const candleStart = Math.floor(
    baseCandle.timestamp / (timeframeSeconds * 1000),
  ) * (timeframeSeconds * 1000);
  
  // –ü–æ–ª—É—á–∞–µ–º –∏–ª–∏ —Å–æ–∑–¥–∞–µ–º –∞–≥—Ä–µ–≥–∞—Ç–æ—Ä –¥–ª—è —ç—Ç–æ–≥–æ —Ç–∞–π–º—Ñ—Ä–µ–π–º–∞
  let aggregator = this.aggregators.get(timeframe);
  
  if (!aggregator || aggregator.timestamp !== candleStart) {
    // –ù–æ–≤–∞—è —Å–≤–µ—á–∞ –¥–ª—è —ç—Ç–æ–≥–æ —Ç–∞–π–º—Ñ—Ä–µ–π–º–∞
    // –ü—Ä–∞–≤–∏–ª–æ: open[n] = close[n-1]
    const previousClose = aggregator ? aggregator.close : baseCandle.open;
    
    aggregator = {
      open: previousClose,  // –ù–∞—á–∞–ª–æ = –∫–æ–Ω–µ—Ü –ø—Ä–µ–¥—ã–¥—É—â–µ–π
      high: baseCandle.high,
      low: baseCandle.low,
      close: baseCandle.close,
      timestamp: candleStart,
      timeframe,
    };
    
    this.aggregators.set(timeframe, aggregator);
  } else {
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Å–≤–µ—á—É
    aggregator.high = Math.max(aggregator.high, baseCandle.high);
    aggregator.low = Math.min(aggregator.low, baseCandle.low);
    aggregator.close = baseCandle.close; // –û–±–Ω–æ–≤–ª—è–µ–º close –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
  }
  
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω—É–∂–Ω–æ –ª–∏ –∑–∞–∫—Ä—ã—Ç—å —Å–≤–µ—á—É
  const nextCandleStart = candleStart + timeframeSeconds * 1000;
  if (baseCandle.timestamp >= nextCandleStart - 100) {
    // –ó–∞–∫—Ä—ã–≤–∞–µ–º —Å–≤–µ—á—É –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –ë–î
    this.closeAggregatedCandle(aggregator);
    this.aggregators.set(timeframe, null);
  }
}
```

#### 4. –ü—Ä–∏–º–µ—Ä –∞–≥—Ä–µ–≥–∞—Ü–∏–∏: 5s ‚Üí 30s

```
–ë–∞–∑–æ–≤—ã–µ 5s —Å–≤–µ—á–∏:
[10:00:00-10:00:05] open=100, high=101, low=99, close=100.5
[10:00:05-10:00:10] open=100.5, high=102, low=100, close=101
[10:00:10-10:00:15] open=101, high=101.5, low=100.5, close=101.2
[10:00:15-10:00:20] open=101.2, high=102, low=101, close=101.8
[10:00:20-10:00:25] open=101.8, high=102.5, low=101.5, close=102
[10:00:25-10:00:30] open=102, high=103, low=101.8, close=102.5

–ê–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω–∞—è 30s —Å–≤–µ—á–∞:
[10:00:00-10:00:30] 
  open = 100 (open –ø–µ—Ä–≤–æ–π –±–∞–∑–æ–≤–æ–π —Å–≤–µ—á–∏)
  high = 103 (max –≤—Å–µ—Ö high)
  low = 99 (min –≤—Å–µ—Ö low)
  close = 102.5 (close –ø–æ—Å–ª–µ–¥–Ω–µ–π –±–∞–∑–æ–≤–æ–π —Å–≤–µ—á–∏)
```

#### 5. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∞–≥—Ä–µ–≥–∞—Ü–∏–∏

**–§–∞–π–ª**: `backend/src/prices/PriceEngineManager.ts`

```typescript
const CANDLE_CONFIG = {
  baseTimeframe: '5s' as const,
  aggregationTimeframes: [
    '10s', '15s', '30s', '1m', '2m', '3m', '5m', 
    '10m', '15m', '30m', '1h', '4h', '1d'
  ] as Timeframe[],
};
```

**–í–∞–∂–Ω–æ**: –ë–∞–∑–æ–≤—ã–π —Ç–∞–π–º—Ñ—Ä–µ–π–º `5s` –ù–ï –≤–∫–ª—é—á–∞–µ—Ç—Å—è –≤ `aggregationTimeframes`, —Ç–∞–∫ –∫–∞–∫ –æ–Ω –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é.

---

## üéØ –§—Ä–æ–Ω—Ç–µ–Ω–¥: –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–∞–π–º—Ñ—Ä–µ–π–º–∞

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

```
useChart (–æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä)
  ‚îú‚îÄ‚îÄ useChartData (–¥–∞–Ω–Ω—ã–µ —Å–≤–µ—á–µ–π)
  ‚îÇ     ‚îú‚îÄ‚îÄ initializeFromSnapshot (–∑–∞–≥—Ä—É–∑–∫–∞ snapshot)
  ‚îÇ     ‚îú‚îÄ‚îÄ prependCandles (–∑–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏)
  ‚îÇ     ‚îî‚îÄ‚îÄ reset (–æ—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö)
  ‚îú‚îÄ‚îÄ useViewport (–≤–∏–¥–∏–º–∞—è –æ–±–ª–∞—Å—Ç—å)
  ‚îÇ     ‚îú‚îÄ‚îÄ recalculateViewport (–ø–µ—Ä–µ—Å—á–µ—Ç viewport)
  ‚îÇ     ‚îî‚îÄ‚îÄ reset (—Å–±—Ä–æ—Å viewport)
  ‚îú‚îÄ‚îÄ useChartInteractions (–≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è)
  ‚îÇ     ‚îî‚îÄ‚îÄ reset (—Å–±—Ä–æ—Å pan/zoom)
  ‚îú‚îÄ‚îÄ useCandleAnimator (–∞–Ω–∏–º–∞—Ü–∏–∏)
  ‚îÇ     ‚îî‚îÄ‚îÄ reset (—Å–±—Ä–æ—Å –∞–Ω–∏–º–∞—Ü–∏–π)
  ‚îî‚îÄ‚îÄ useHistoryLoader (–∑–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏)
        ‚îî‚îÄ‚îÄ reset (—Å–±—Ä–æ—Å –∏—Å—Ç–æ—Ä–∏–∏)
```

### –ü—Ä–æ—Ü–µ—Å—Å –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ç–∞–π–º—Ñ—Ä–µ–π–º–∞

**–§–∞–π–ª**: `frontend/components/chart/useChart.ts`

#### –®–∞–≥ 1: –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

```typescript
// –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π —Ç–∞–π–º—Ñ—Ä–µ–π–º
const previousTimeframeRef = useRef<string>(timeframe);

useEffect(() => {
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏–µ timeframe
  const timeframeChanged = previousTimeframeRef.current !== timeframe;
  
  if (timeframeChanged) {
    previousTimeframeRef.current = timeframe;
    // ... –≤—ã–ø–æ–ª–Ω—è–µ–º –ø–æ–ª–Ω—ã–π reset
  }
}, [snapshot, timeframe, instrument]);
```

#### –®–∞–≥ 2: –ü–æ–ª–Ω—ã–π reset –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

–ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ç–∞–π–º—Ñ—Ä–µ–π–º–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è **–ø–æ–ª–Ω—ã–π reset** –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ:

```typescript
if (timeframeChanged) {
  // üî• –®–∞–≥ 1: Reset viewport (—Å–±—Ä–æ—Å zoom/pan, follow mode = true)
  viewport.reset();
  
  // üî• –®–∞–≥ 2: Reset interactions (—Å–±—Ä–æ—Å pan/zoom —Å–æ—Å—Ç–æ—è–Ω–∏—è)
  chartInteractions.reset();
  
  // üî• –®–∞–≥ 3: Reset –¥–∞–Ω–Ω—ã—Ö —Å–≤–µ—á–µ–π (–æ—á–∏—Å—Ç–∫–∞ –≤—Å–µ—Ö —Å–≤–µ—á–µ–π)
  chartData.reset();
  
  // üî• –®–∞–≥ 4: Reset –∞–Ω–∏–º–∞—Ü–∏–∏ (–æ—á–∏—Å—Ç–∫–∞ –∞–Ω–∏–º–∞—Ü–∏–π)
  candleAnimator.reset();
  
  // üî• –®–∞–≥ 5: Reset history loader (–æ—á–∏—Å—Ç–∫–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤)
  historyLoader.reset();
}
```

#### –®–∞–≥ 3: –î–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∫–∞–∂–¥–æ–≥–æ reset

##### 3.1. viewport.reset()

**–§–∞–π–ª**: `frontend/components/chart/internal/useViewport.ts`

```typescript
const reset = (): void => {
  // –°–±—Ä–∞—Å—ã–≤–∞–µ–º viewport –≤ null (–±—É–¥–µ—Ç –ø–µ—Ä–µ—Å—á–∏—Ç–∞–Ω –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º recalculateViewport)
  viewportRef.current = null;
  
  // –°–±—Ä–∞—Å—ã–≤–∞–µ–º follow mode –≤ true (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤–∫–ª—é—á–µ–Ω)
  followModeRef.current = true;
  
  // –û—á–∏—â–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏–∏
  targetViewportRef.current = null;
  followAnimationStartRef.current = null;
  
  // –û—á–∏—â–∞–µ–º Y-scale drag
  yDragRef.current = null;
  
  // –û—á–∏—â–∞–µ–º —è–∫–æ—Ä—å –≤—Ä–µ–º–µ–Ω–∏
  latestCandleTimeRef.current = null;
  
  // –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º visibleCandles –Ω–∞ –æ—Å–Ω–æ–≤–µ canvasWidth
  const calculatedVisibleCandles = calculateVisibleCandles(getCanvasWidth());
  configRef.current = {
    ...DEFAULT_CONFIG,
    visibleCandles: calculatedVisibleCandles,
    ...config,
  };
};
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç**:
- Viewport –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—á–∏—â–∞–µ—Ç—Å—è
- Follow mode –≤–∫–ª—é—á–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- –í—Å–µ –∞–Ω–∏–º–∞—Ü–∏–∏ –∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π —Å–±—Ä–∞—Å—ã–≤–∞—é—Ç—Å—è
- `visibleCandles` –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –Ω–æ–≤–æ–≥–æ —Ç–∞–π–º—Ñ—Ä–µ–π–º–∞ (—á–µ—Ä–µ–∑ `canvasWidth / TARGET_CANDLE_PX`)

##### 3.2. chartInteractions.reset()

**–§–∞–π–ª**: `frontend/components/chart/internal/interactions/useChartInteractions.ts`

```typescript
const reset = (): void => {
  // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ pan (–ø—Ä–µ—Ä—ã–≤–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π drag –µ—Å–ª–∏ –µ—Å—Ç—å)
  interactionStateRef.current = {
    isDragging: false,
    lastX: null,
  };
  
  // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ Y-scale drag (–ø—Ä–µ—Ä—ã–≤–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π drag –µ—Å–ª–∏ –µ—Å—Ç—å)
  yDragStateRef.current = false;
  
  // –ó–∞–≤–µ—Ä—à–∞–µ–º Y-scale drag –µ—Å–ª–∏ –æ–Ω –±—ã–ª –∞–∫—Ç–∏–≤–µ–Ω
  if (endYScaleDrag) {
    endYScaleDrag();
  }
};
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç**:
- –ü—Ä–µ—Ä—ã–≤–∞–µ—Ç—Å—è –∞–∫—Ç–∏–≤–Ω—ã–π pan (–µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–ª –≥—Ä–∞—Ñ–∏–∫)
- –ü—Ä–µ—Ä—ã–≤–∞–µ—Ç—Å—è –∞–∫—Ç–∏–≤–Ω—ã–π Y-scale drag (–µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–ª –ø–æ Y)
- –í—Å–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π –æ—á–∏—â–∞—é—Ç—Å—è

##### 3.3. chartData.reset()

**–§–∞–π–ª**: `frontend/components/chart/internal/useChartData.ts`

```typescript
const reset = (): void => {
  candlesRef.current = [];              // –û—á–∏—â–∞–µ–º –≤—Å–µ –∑–∞–∫—Ä—ã—Ç—ã–µ —Å–≤–µ—á–∏
  liveCandleRef.current = null;          // –û—á–∏—â–∞–µ–º live-—Å–≤–µ—á—É
  earliestRealTimeRef.current = null;    // –û—á–∏—â–∞–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –¥–ª—è API
  realStartTimesRef.current = new Set(); // –û—á–∏—â–∞–µ–º –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—é
  anchorTimeRef.current = null;         // üî• –°–±—Ä–∞—Å—ã–≤–∞–µ–º anchorTime –¥–ª—è –Ω–æ–≤–æ–≥–æ –¢–§
};
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç**:
- –í—Å–µ –¥–∞–Ω–Ω—ã–µ —Å–≤–µ—á–µ–π –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—á–∏—â–∞—é—Ç—Å—è
- `anchorTime` —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è (–±—É–¥–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –Ω–æ–≤–æ–≥–æ snapshot)
- –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏—Å—Ç–æ—Ä–∏–∏ –æ—á–∏—â–∞—é—Ç—Å—è

##### 3.4. candleAnimator.reset()

**–§–∞–π–ª**: `frontend/components/chart/internal/useCandleAnimator.ts`

```typescript
const reset = (): void => {
  animatingCandleRef.current = null;
  animationStartTimeRef.current = null;
  // –û—á–∏—â–∞–µ–º –≤—Å–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∞–Ω–∏–º–∞—Ü–∏–∏
};
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç**:
- –ü—Ä–µ—Ä—ã–≤–∞—é—Ç—Å—è –≤—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ –∞–Ω–∏–º–∞—Ü–∏–∏ —Å–≤–µ—á–µ–π
- –°–æ—Å—Ç–æ—è–Ω–∏—è –∞–Ω–∏–º–∞—Ü–∏–∏ –æ—á–∏—â–∞—é—Ç—Å—è

##### 3.5. historyLoader.reset()

**–§–∞–π–ª**: `frontend/components/chart/internal/history/useHistoryLoader.ts`

```typescript
const reset = (): void => {
  loadedRangesRef.current = [];
  hasMoreRef.current = true;
  // –û—á–∏—â–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –¥–∏–∞–ø–∞–∑–æ–Ω–∞—Ö
};
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç**:
- –û—á–∏—â–∞–µ—Ç—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–æ–º, –∫–∞–∫–∏–µ –¥–∏–∞–ø–∞–∑–æ–Ω—ã –∏—Å—Ç–æ—Ä–∏–∏ —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã
- `hasMore` —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –≤ `true` (–º–æ–∂–Ω–æ –∑–∞–≥—Ä—É–∂–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é –∑–∞–Ω–æ–≤–æ)

#### –®–∞–≥ 4: –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–æ–≤–æ–≥–æ snapshot

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö reset, –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –Ω–æ–≤—ã–π snapshot –¥–ª—è –Ω–æ–≤–æ–≥–æ —Ç–∞–π–º—Ñ—Ä–µ–π–º–∞:

```typescript
// –ï—Å–ª–∏ timeframe –Ω–µ –∏–∑–º–µ–Ω–∏–ª—Å—è, –Ω–æ snapshot –∏–∑–º–µ–Ω–∏–ª—Å—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ)
if (!timeframeChanged) {
  chartData.reset();
  candleAnimator.reset();
  historyLoader.reset();
}

const candles = snapshot.candles.items;
const currentPrice = snapshot.price.value;
const currentTime = snapshot.price.timestamp;

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ –Ω–æ–≤–æ–≥–æ snapshot
chartData.initializeFromSnapshot(candles, currentPrice, currentTime, timeframeMs);

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º server time
serverTimeRef.current = {
  timestamp: snapshot.serverTime,
  utcOffsetMinutes: -new Date().getTimezoneOffset(),
};
lastSyncTimeRef.current = performance.now();

// –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º viewport —Å –Ω–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
setTimeout(() => {
  viewport.recalculateViewport();
  viewport.setLatestCandleTime(chartData.getLiveCandle()?.endTime ?? currentTime);
}, 0);
```

---

## üéØ Timeframe-aware initial zoom

### –ü—Ä–æ–±–ª–µ–º–∞ –∫–æ–Ω—Ü–µ–ø—Ç—É–∞–ª—å–Ω–∞—è

**–°–º–µ—à–∏–≤–∞–Ω–∏–µ –¥–≤—É—Ö –º–æ–¥–µ–ª–µ–π**:
- ‚úÖ **Time-based –º–æ–¥–µ–ª—å**: `viewport = timeStart / timeEnd`, `timeRange = visibleCandles * timeframeMs`
- ‚ùå **Pixel-based –æ–∂–∏–¥–∞–Ω–∏–µ**: "–º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è / –¥–µ—Ñ–æ–ª—Ç–Ω–∞—è / –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —à–∏—Ä–∏–Ω–∞ —Å–≤–µ—á–∏ –æ–¥–∏–Ω–∞–∫–æ–≤–∞ –Ω–∞ –≤—Å–µ—Ö –¢–§"

**–≠—Ç–∏ –¥–≤–µ –≤–µ—â–∏ –ù–ï –ú–û–ì–£–¢ –±—ã—Ç—å –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ** –≤ —á–∏—Å—Ç–æ–π time-based –º–æ–¥–µ–ª–∏.

**–ü–æ—á–µ–º—É**:
```
distanceBetweenCandles = (timeframeMs / timeRange) * canvasWidth

–î–ª—è 30s:
–¥–∞–∂–µ –ø—Ä–∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–º zoom-out
distance –§–ò–ó–ò–ß–ï–°–ö–ò –±–æ–ª—å—à–µ, —á–µ–º —É 5s

‚û°Ô∏è –ü–æ—ç—Ç–æ–º—É:
30s –≤—Å–µ–≥–¥–∞ —Ç–æ–ª—â–µ, –µ—Å–ª–∏ viewport –Ω–µ —Ä–∞—Å—à–∏—Ä—è—Ç—å –¥–∞–ª—å—à–µ
```

### –†–µ—à–µ–Ω–∏–µ: –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç —Ç–∞–π–º—Ñ—Ä–µ–π–º–∞

**–ü—Ä–∏–Ω—Ü–∏–ø (–∑–∞–∫–æ–Ω)**:
> –¢–∞–π–º—Ñ—Ä–µ–π–º –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç "–º–∞—Å—à—Ç–∞–± –º–∏—Ä–∞", zoom ‚Äî —Å–∫–æ–ª—å–∫–æ —ç—Ç–æ–≥–æ –º–∏—Ä–∞ –≤–∏–¥–Ω–æ

**–§–∞–π–ª**: `frontend/components/chart/internal/useViewport.ts`

```typescript
const BASE_TIMEFRAME_MS = 5000; // –ë–∞–∑–æ–≤—ã–π —Ç–∞–π–º—Ñ—Ä–µ–π–º (5s)

function calculateVisibleCandles(canvasWidth: number | null, timeframeMs: number): number {
  if (!canvasWidth || canvasWidth <= 0) {
    return DEFAULT_CONFIG.visibleCandles;
  }
  
  // üî• –ë–∞–∑–æ–≤–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–≤–µ—á–µ–π –¥–ª—è –±–∞–∑–æ–≤–æ–≥–æ —Ç–∞–π–º—Ñ—Ä–µ–π–º–∞ (5s)
  const baseVisible = canvasWidth / TARGET_CANDLE_PX;
  
  // üî• –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç —Ç–∞–π–º—Ñ—Ä–µ–π–º–∞: –≤–æ —Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ —Ç–µ–∫—É—â–∏–π –¢–§ –±–æ–ª—å—à–µ –±–∞–∑–æ–≤–æ–≥–æ
  const timeframeMultiplier = timeframeMs / BASE_TIMEFRAME_MS;
  
  // üî• –£–º–Ω–æ–∂–∞–µ–º –Ω–∞ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç: –±–æ–ª—å—à–∏–µ –¢–§ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ "–æ—Ç–æ–¥–≤–∏–≥–∞—é—Ç—Å—è –Ω–∞–∑–∞–¥"
  const rawVisible = baseVisible * timeframeMultiplier;
  
  // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º –∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º
  return Math.max(
    MIN_VISIBLE_CANDLES,
    Math.min(MAX_VISIBLE_CANDLES, Math.round(rawVisible))
  );
}
```

### –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

| –¢–∞–π–º—Ñ—Ä–µ–π–º | timeframeMs | multiplier | baseVisible (1000px) | visibleCandles | –†–µ–∑—É–ª—å—Ç–∞—Ç |
|-----------|-------------|------------|---------------------|----------------|-----------|
| 5s        | 5000        | 1.0        | 71                  | 71             | –ë–∞–∑–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å |
| 10s       | 10000       | 2.0        | 71                  | 142            | –í 2 —Ä–∞–∑–∞ –¥–∞–ª—å—à–µ |
| 30s       | 30000       | 6.0        | 71                  | 426 ‚Üí 300*     | –í 6 —Ä–∞–∑ –¥–∞–ª—å—à–µ |
| 1m        | 60000       | 12.0       | 71                  | 852 ‚Üí 300*     | –í 12 —Ä–∞–∑ –¥–∞–ª—å—à–µ |

*–û–≥—Ä–∞–Ω–∏—á–µ–Ω–æ `MAX_VISIBLE_CANDLES = 300`

### –ß—Ç–æ —ç—Ç–æ –¥–∞–µ—Ç

1. **–û–¥–∏–Ω–∞–∫–æ–≤–∞—è –≤–∏–∑—É–∞–ª—å–Ω–∞—è –ø–ª–æ—Ç–Ω–æ—Å—Ç—å**:
   - –ü—Ä–∏ –æ–¥–∏–Ω–∞–∫–æ–≤–æ–º zoom level —Å–≤–µ—á–∏ –≤—ã–≥–ª—è–¥—è—Ç –æ–¥–∏–Ω–∞–∫–æ–≤–æ –Ω–∞ –≤—Å–µ—Ö –¢–§
   - –ë–æ–ª—å—à–∏–µ –¢–§ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å—Ç–∞—Ä—Ç—É—é—Ç —Å –±–æ–ª—å—à–∏–º `visibleCandles`

2. **–ú–µ—Ç–∞—Ñ–æ—Ä–∞ "–¥–µ—Ä–µ–≤–æ –∏ –æ–∫–Ω–æ"**:
   - –î–µ—Ä–µ–≤–æ (—Ç–∞–π–º—Ñ—Ä–µ–π–º) —Å—Ç–∞–ª–æ –±–æ–ª—å—à–µ ‚Üí –º—ã –æ—Ç–æ—à–ª–∏ –Ω–∞–∑–∞–¥ (—É–≤–µ–ª–∏—á–∏–ª–∏ `visibleCandles`)
   - –†–∞–∑–º–µ—Ä –æ–∫–Ω–∞ (–≤–∏–∑—É–∞–ª—å–Ω–∞—è —à–∏—Ä–∏–Ω–∞ —Å–≤–µ—á–∏) –æ—Å—Ç–∞–µ—Ç—Å—è –ø—Ä–∏–º–µ—Ä–Ω–æ –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º

3. **–ü—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ**:
   - –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –¢–§ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç —Ä—É—á–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ zoom
   - –ì—Ä–∞—Ñ–∏–∫ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –º–∞—Å—à—Ç–∞–±

### –ü–æ—á–µ–º—É reload "–º–∞–≥–∏—á–µ—Å–∫–∏ —á–∏–Ω–∏—Ç –≤—Å—ë"

–ü—Ä–∏ reload —Å—Ç—Ä–∞–Ω–∏—Ü—ã:
- Viewport —Å—á–∏—Ç–∞–µ—Ç—Å—è —Å –Ω—É–ª—è
- –ë–µ–∑ —Å—Ç–∞—Ä–æ–≥–æ zoom-–∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
- –ò–Ω—Ç—É–∏—Ç–∏–≤–Ω–æ —É–∂–µ –¥–µ–ª–∞–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –Ω–∞—á–∞–ª—å–Ω–∞—è —Ç–æ—á–∫–∞

**–ú—ã –ø—Ä–æ—Å—Ç–æ —Ñ–æ—Ä–º–∞–ª–∏–∑—É–µ–º —ç—Ç–æ –ø—Ä–∞–≤–∏–ª–æ** —á–µ—Ä–µ–∑ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç —Ç–∞–π–º—Ñ—Ä–µ–π–º–∞.

---

## üî• Hard reset —á–µ—Ä–µ–∑ React key

### –ü—Ä–æ–±–ª–µ–º–∞: –ø–æ—á–µ–º—É —Ç–µ–∫—É—â–∏–π reset "–ø–æ—á—Ç–∏, –Ω–æ –Ω–µ –¥–æ –∫–æ–Ω—Ü–∞"

**–¢–µ–∫—É—â–∏–π reset –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤–Ω—É—Ç—Ä–∏ –æ–¥–Ω–æ–≥–æ instance**:
- –°—Ç–∞—Ä—ã–µ —á–∏—Å–ª–∞ –≤—Å—ë —Ä–∞–≤–Ω–æ –≤–ª–∏—è—é—Ç:
  - wheel deltas
  - anchorRatio
  - canvasWidth ‚Üí visibleCandles
  - RAF timing
  - –°–æ—Å—Ç–æ—è–Ω–∏—è –≤ refs

**React unmount —á–∏—â–µ –ª—é–±–æ–≥–æ reset()**:
- –ü–æ–ª–Ω–æ–µ —É–Ω–∏—á—Ç–æ–∂–µ–Ω–∏–µ –≤—Å–µ—Ö refs (GC)
- –û—Ç–º–µ–Ω–∞ –≤—Å–µ—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤
- –û—á–∏—Å—Ç–∫–∞ –≤—Å–µ—Ö –ø–æ–¥–ø–∏—Å–æ–∫
- –ù–µ—Ç –Ω–∏–∫–∞–∫–∏—Ö –ø–µ—Ä–µ—Ö–æ–¥–Ω—ã—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π

### –†–µ—à–µ–Ω–∏–µ: hard reset —á–µ—Ä–µ–∑ React key

**–ü—Ä–∏–Ω—Ü–∏–ø**:
> Timeframe change = –Ω–æ–≤—ã–π chart instance

**–§–∞–π–ª**: `frontend/app/terminal/page.tsx`

```typescript
// üî• FLOW: Hard Chart Reinitialization on Timeframe Change
// –ò—Å–ø–æ–ª—å–∑—É–µ–º key –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–∞ –ø—Ä–∏ —Å–º–µ–Ω–µ –¢–§
// –≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –ø–æ–ª–Ω—ã–π reset –∫–∞–∫ –ø—Ä–∏ reload —Å—Ç—Ä–∞–Ω–∏—Ü—ã
<ChartContainer
  key={`${instrument}_${timeframe}`}
  type={chartType}
  className="w-full h-full"
  // ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ props
/>
```

### –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–ü—Ä–∏ —Å–º–µ–Ω–µ timeframe**:
1. React –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–µ `key`
2. –í—ã–ø–æ–ª–Ω—è–µ—Ç **–ø–æ–ª–Ω—ã–π unmount** —Å—Ç–∞—Ä–æ–≥–æ –≥—Ä–∞—Ñ–∏–∫–∞:
   - –í—Å–µ refs —É–Ω–∏—á—Ç–æ–∂–∞—é—Ç—Å—è (GC)
   - –í—Å–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –æ—á–∏—â–∞—é—Ç—Å—è
   - –í—Å–µ —ç—Ñ—Ñ–µ–∫—Ç—ã –æ—Ç–º–µ–Ω—è—é—Ç—Å—è
   - –í—Å–µ –ø–æ–¥–ø–∏—Å–∫–∏ –æ—Ç–∫–ª—é—á–∞—é—Ç—Å—è
3. –í—ã–ø–æ–ª–Ω—è–µ—Ç **–ø–æ–ª–Ω—ã–π mount** –Ω–æ–≤–æ–≥–æ –≥—Ä–∞—Ñ–∏–∫–∞:
   - –°–æ–∑–¥–∞—é—Ç—Å—è –Ω–æ–≤—ã–µ refs (—á–∏—Å—Ç—ã–µ)
   - –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É—é—Ç—Å—è –Ω–æ–≤—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
   - –ü–æ–¥–∫–ª—é—á–∞—é—Ç—Å—è –Ω–æ–≤—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã
   - –ù–µ—Ç –Ω–∏–∫–∞–∫–∏—Ö —Å—Ç–∞—Ä—ã—Ö —á–∏—Å–ª–æ–≤—ã—Ö –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–≤

### –ß—Ç–æ —ç—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç

‚úÖ **–ù–µ—Ç –Ω–∏ –æ–¥–Ω–æ–≥–æ —Å—Ç–∞—Ä–æ–≥–æ —á–∏—Å–ª–æ–≤–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞**:
- –ù–∏ zoom
- –ù–∏ visibleCandles
- –ù–∏ anchorRatio
- –ù–∏ wheel-–¥–µ–ª—å—Ç

‚úÖ **Viewport —Å–æ–∑–¥–∞—ë—Ç—Å—è –û–î–ò–ù –†–ê–ó**:
- –°—Ä–∞–∑—É –ø–æ–¥ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π timeframe
- –°—Ä–∞–∑—É –ø–æ–¥ —Ç–µ–∫—É—â—É—é —à–∏—Ä–∏–Ω—É canvas

‚úÖ **–ù–∏–∫–∞–∫–∏—Ö –ø–µ—Ä–µ—Ö–æ–¥–Ω—ã—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π**:
- –ù–µ—Ç –º–æ–º–µ–Ω—Ç–∞ "–±—ã–ª 5s ‚Üí —Å—Ç–∞–ª 30s"
- –ï—Å—Ç—å —Ç–æ–ª—å–∫–æ "30s –º–∏—Ä —Å—É—â–µ—Å—Ç–≤—É–µ—Ç"

### –ü–æ—á–µ–º—É —ç—Ç–æ –ù–ï –∫–æ—Å—Ç—ã–ª—å

**–≠—Ç–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç –∏–Ω–¥—É—Å—Ç—Ä–∏–∏**:
- TradingView –¥–µ–ª–∞–µ—Ç —Ç–∞–∫
- CQG –¥–µ–ª–∞–µ—Ç —Ç–∞–∫
- Ninja –¥–µ–ª–∞–µ—Ç —Ç–∞–∫

**Timeframe ‚Äî —ç—Ç–æ –Ω–µ –ø–∞—Ä–∞–º–µ—Ç—Ä**:
- –≠—Ç–æ –¥—Ä—É–≥–∞—è —Å–∏—Å—Ç–µ–º–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç
- –î—Ä—É–≥–æ–π –º–∞—Å—à—Ç–∞–± –º–∏—Ä–∞
- –î—Ä—É–≥–æ–π —Å–º—ã—Å–ª zoom

**–ù–µ –¥–æ–ª–∂–Ω—ã —Å–æ—Ö—Ä–∞–Ω—è—Ç—å—Å—è –º–µ–∂–¥—É –¢–§**:
- ‚ùå zoom
- ‚ùå pan
- ‚ùå density
- ‚ùå –ª—é–±—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è

### –†–µ–∑—É–ª—å—Ç–∞—Ç

- ‚úÖ –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –¢–§ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ—á–Ω–æ –∫–∞–∫ reload —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- ‚úÖ –ù–µ—Ç –ø–µ—Ä–µ—Ö–æ–¥–Ω—ã—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π
- ‚úÖ –ù–µ—Ç —Å—Ç–∞—Ä—ã—Ö —á–∏—Å–ª–æ–≤—ã—Ö –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–≤
- ‚úÖ –ì—Ä–∞—Ñ–∏–∫ –≤—Å–µ–≥–¥–∞ –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏
- ‚úÖ –†–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É –ø–æ–ª–Ω–æ—Å—Ç—å—é, –∞ –Ω–µ –Ω–∞ 90%

---

## ‚è∞ –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–∏

### –ü—Ä–æ–±–ª–µ–º–∞

–ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ —Å–≤–µ—á–∏ –∏–∑ –ë–î –º–æ–≥—É—Ç –∏–º–µ—Ç—å **–ø—Ä–æ–ø—É—Å–∫–∏** (gaps) –º–µ–∂–¥—É —Å–≤–µ—á–∞–º–∏:
- –°–≤–µ—á–∞ 1: `startTime = 1000`, `endTime = 5000`
- –°–≤–µ—á–∞ 2: `startTime = 15000`, `endTime = 20000` ‚Üê **–ø—Ä–æ–ø—É—Å–∫ 10 —Å–µ–∫—É–Ω–¥!**

–ï—Å–ª–∏ —Ä–∏—Å–æ–≤–∞—Ç—å —Å–≤–µ—á–∏ –ø–æ –∏—Ö —Ä–µ–∞–ª—å–Ω—ã–º –≤—Ä–µ–º–µ–Ω–Ω—ã–º –º–µ—Ç–∫–∞–º, –Ω–∞ –≥—Ä–∞—Ñ–∏–∫–µ –±—É–¥—É—Ç –≤–∏–∑—É–∞–ª—å–Ω—ã–µ –¥—ã—Ä–∫–∏.

### –†–µ—à–µ–Ω–∏–µ: –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–∏

**–ö–æ–Ω—Ü–µ–ø—Ü–∏—è**: –ö–∞–∂–¥–∞—è —Å–≤–µ—á–∞ –∑–∞–Ω–∏–º–∞–µ—Ç **—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –≤—Ä–µ–º–µ–Ω–Ω–æ–π —Å–ª–æ—Ç**, —Ä–∞–≤–Ω—ã–π `timeframeMs`.

**–§–∞–π–ª**: `frontend/components/chart/internal/useChartData.ts`

#### –ü—Ä–æ—Ü–µ—Å—Å –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏ initializeFromSnapshot

```typescript
const initializeFromSnapshot = (
  snapshotCandles: SnapshotCandle[],
  currentPrice: number,
  currentTime: number,
  timeframeMs: number
): void => {
  // ... –≤–∞–ª–∏–¥–∞—Ü–∏—è ...
  
  // üî• –®–∞–≥ 1: –û–ø—Ä–µ–¥–µ–ª—è–µ–º anchorTime (—è–∫–æ—Ä—å –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏)
  // –ò—Å–ø–æ–ª—å–∑—É–µ–º –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å–≤–µ—á–∏ –∫–∞–∫ —è–∫–æ—Ä—å
  const lastSnapshotCandle = snapshotCandles[snapshotCandles.length - 1];
  const anchorTime = lastSnapshotCandle.endTime;
  
  // üî• –°–æ—Ö—Ä–∞–Ω—è–µ–º anchorTime –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ prependCandles
  anchorTimeRef.current = anchorTime;
  
  // üî• –®–∞–≥ 2: –í—ã—á–∏—Å–ª—è–µ–º –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è –ø–µ—Ä–≤–æ–π —Å–≤–µ—á–∏
  // –û—Ç—Å—á–∏—Ç—ã–≤–∞–µ–º –Ω–∞–∑–∞–¥ –æ—Ç —è–∫–æ—Ä—è
  const firstNormalizedTime = anchorTime - (snapshotCandles.length * timeframeMs);
  
  // üî• –®–∞–≥ 3: –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º –∫–∞–∂–¥—É—é —Å–≤–µ—á—É
  for (let i = 0; i < snapshotCandles.length; i++) {
    const snapshotCandle = snapshotCandles[i];
    
    // –í—ã—á–∏—Å–ª—è–µ–º –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è –¥–ª—è —ç—Ç–æ–π —Å–≤–µ—á–∏
    const normalizedStartTime = firstNormalizedTime + i * timeframeMs;
    const normalizedEndTime = normalizedStartTime + timeframeMs;
    
    // –°–æ–∑–¥–∞–µ–º –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—É—é —Å–≤–µ—á—É
    const normalizedCandle = normalizeCandle({
      ...snapshotCandle,
      startTime: normalizedStartTime,  // –ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è
      endTime: normalizedEndTime,      // –ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è
      isClosed: true,
    });
    
    closedCandles.push(normalizedCandle);
  }
  
  // üî• –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç open[n] === close[n-1]
  for (let i = 1; i < closedCandles.length; i++) {
    const prev = closedCandles[i - 1];
    const curr = closedCandles[i];
    if (curr.open !== prev.close) {
      // –ò—Å–ø—Ä–∞–≤–ª—è–µ–º –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç
      closedCandles[i] = normalizeCandle({
        ...curr,
        open: prev.close,
      });
    }
  }
  
  candlesRef.current = closedCandles;
  
  // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–µ–∞–ª—å–Ω—ã–µ timestamps –¥–ª—è API pagination
  earliestRealTimeRef.current = snapshotCandles[0].startTime;
  realStartTimesRef.current = new Set(snapshotCandles.map((c) => c.startTime));
};
```

#### –ü—Ä–∏–º–µ—Ä –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏

**–î–æ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏** (—Ä–µ–∞–ª—å–Ω—ã–µ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏ –∏–∑ –ë–î):
```
–°–≤–µ—á–∞ 1: startTime=1000, endTime=5000
–°–≤–µ—á–∞ 2: startTime=15000, endTime=20000  ‚Üê –ø—Ä–æ–ø—É—Å–∫ 10 —Å–µ–∫—É–Ω–¥
–°–≤–µ—á–∞ 3: startTime=25000, endTime=30000  ‚Üê –ø—Ä–æ–ø—É—Å–∫ 5 —Å–µ–∫—É–Ω–¥
```

**–ü–æ—Å–ª–µ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏** (–¥–ª—è —Ç–∞–π–º—Ñ—Ä–µ–π–º–∞ 5s):
```
anchorTime = 30000 (endTime –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å–≤–µ—á–∏)

–°–≤–µ—á–∞ 1: startTime=15000, endTime=20000  (30000 - 3*5000 = 15000)
–°–≤–µ—á–∞ 2: startTime=20000, endTime=25000  (–Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ)
–°–≤–µ—á–∞ 3: startTime=25000, endTime=30000  (–Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ)
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –í—Å–µ —Å–≤–µ—á–∏ –∏–¥—É—Ç –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ, –±–µ–∑ –≤–∏–∑—É–∞–ª—å–Ω—ã—Ö –¥—ã—Ä –Ω–∞ –≥—Ä–∞—Ñ–∏–∫–µ.

---

## üîç Zoom —á–µ—Ä–µ–∑ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–≤–µ—á–µ–π

### –ü—Ä–æ–±–ª–µ–º–∞ —Å—Ç–∞—Ä–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

**–°—Ç–∞—Ä–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è** (—Ä–∞–±–æ—Ç–∞–ª–∞ —á–µ—Ä–µ–∑ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥—ã):
```typescript
// ‚ùå –ü–†–û–ë–õ–ï–ú–ê: zoomFactor –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ç–µ–∫—É—â–µ–≥–æ timeRange
const zoomFactor = 1.1; // +10%
const newTimeRange = currentTimeRange * zoomFactor;

// –î–ª—è 5s: timeRange = 300000ms ‚Üí newTimeRange = 330000ms (+30000ms = +6 —Å–≤–µ—á–µ–π)
// –î–ª—è 30s: timeRange = 1800000ms ‚Üí newTimeRange = 1980000ms (+180000ms = +6 —Å–≤–µ—á–µ–π)
// ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –æ–¥–∏–Ω–∞–∫–æ–≤–æ

// –ù–û! –ü—Ä–∏ —Å–º–µ–Ω–µ –¢–§:
// –ë—ã–ª–æ: 5s, zoomed in –¥–æ 100000ms (20 —Å–≤–µ—á–µ–π)
// –ü–µ—Ä–µ–∫–ª—é—á–∏–ª–∏ –Ω–∞ 30s ‚Üí timeRange = 600000ms (20 —Å–≤–µ—á–µ–π)
// –ü–æ–ø—Ä–æ–±–æ–≤–∞–ª–∏ zoom out ‚Üí +10% = +60000ms = +2 —Å–≤–µ—á–∏
// rawWidth —É–ª–µ—Ç–µ–ª –≤ MAX_CANDLE_PX ‚Üí "–∑–∞–ª–∏–ø–ª–æ"
```

### –†–µ—à–µ–Ω–∏–µ: zoom —á–µ—Ä–µ–∑ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–≤–µ—á–µ–π

**–ù–æ–≤–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è** (—Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–≤–µ—á–µ–π):

**–§–∞–π–ª**: `frontend/components/chart/internal/interactions/math.ts`

```typescript
export function zoomViewportTime({
  viewport,
  zoomDelta, // –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å–≤–µ—á–µ–π (¬±K)
  anchorTime,
  minVisibleCandles,
  maxVisibleCandles,
  timeframeMs,
}: ZoomViewportTimeParams): Viewport {
  // üî• –®–∞–≥ 1: –í—ã—á–∏—Å–ª—è–µ–º —Ç–µ–∫—É—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–∏–¥–∏–º—ã—Ö —Å–≤–µ—á–µ–π
  const currentTimeRange = viewport.timeEnd - viewport.timeStart;
  const currentVisibleCandles = currentTimeRange / timeframeMs;
  
  // üî• –®–∞–≥ 2: –ò–∑–º–µ–Ω—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–≤–µ—á–µ–π –Ω–∞ zoomDelta
  const newVisibleCandles = currentVisibleCandles - zoomDelta;
  
  // üî• –®–∞–≥ 3: –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–≤–µ—á–µ–π
  const clampedVisibleCandles = Math.max(
    minVisibleCandles,
    Math.min(maxVisibleCandles, newVisibleCandles)
  );
  
  // üî• –®–∞–≥ 4: –í—ã—á–∏—Å–ª—è–µ–º –Ω–æ–≤—ã–π timeRange –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å–≤–µ—á–µ–π
  const newTimeRange = clampedVisibleCandles * timeframeMs;

  // –í—ã—á–∏—Å–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é —è–∫–æ—Ä—è –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —Ç–µ–∫—É—â–µ–≥–æ viewport
  const anchorRatio = (anchorTime - viewport.timeStart) / currentTimeRange;

  // –í—ã—á–∏—Å–ª—è–µ–º –Ω–æ–≤—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —è–∫–æ—Ä—è
  const newTimeStart = anchorTime - newTimeRange * anchorRatio;
  const newTimeEnd = newTimeStart + newTimeRange;

  return {
    ...viewport,
    timeStart: newTimeStart,
    timeEnd: newTimeEnd,
  };
}
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ useChartInteractions**:

```typescript
const ZOOM_CANDLES_PER_STEP = 3; // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–≤–µ—á–µ–π –∑–∞ –æ–¥–∏–Ω —à–∞–≥ wheel

const handleWheel = (e: WheelEvent) => {
  // deltaY > 0 = —Å–∫—Ä–æ–ª–ª –≤–Ω–∏–∑ = zoom out (—É–≤–µ–ª–∏—á–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å–≤–µ—á–µ–π)
  // deltaY < 0 = —Å–∫—Ä–æ–ª–ª –≤–≤–µ—Ä—Ö = zoom in (—É–º–µ–Ω—å—à–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å–≤–µ—á–µ–π)
  const zoomDelta = e.deltaY > 0 ? ZOOM_CANDLES_PER_STEP : -ZOOM_CANDLES_PER_STEP;

  const anchorTime = mouseXToTime(e.clientX, canvas, viewport);
  
  const newViewport = zoomViewportTime({
    viewport,
    zoomDelta,  // ¬±3 —Å–≤–µ—á–∏ –∑–∞ —à–∞–≥
    anchorTime,
    minVisibleCandles: MIN_VISIBLE_CANDLES,
    maxVisibleCandles: MAX_VISIBLE_CANDLES,
    timeframeMs,
  });
  
  // ...
};
```

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞

1. **–û–¥–∏–Ω–∞–∫–æ–≤–æ–µ –æ—â—É—â–µ–Ω–∏–µ zoom –Ω–∞ –≤—Å–µ—Ö –¢–§**:
   - 5s: –æ–¥–∏–Ω —à–∞–≥ = ¬±3 —Å–≤–µ—á–∏
   - 30s: –æ–¥–∏–Ω —à–∞–≥ = ¬±3 —Å–≤–µ—á–∏
   - 1h: –æ–¥–∏–Ω —à–∞–≥ = ¬±3 —Å–≤–µ—á–∏

2. **–ù–µ "—Ä–∞–∑–¥—É–≤–∞–µ—Ç" –±–æ–ª—å—à–∏–µ –¢–§**:
   - –î–ª—è 30s: ¬±3 —Å–≤–µ—á–∏ = ¬±90 —Å–µ–∫—É–Ω–¥
   - –î–ª—è 1h: ¬±3 —Å–≤–µ—á–∏ = ¬±3 —á–∞—Å–∞
   - –í—Å–µ–≥–¥–∞ —É–ø—Ä–∞–≤–ª—è–µ–º –ø–ª–æ—Ç–Ω–æ—Å—Ç—å—é, –∞ –Ω–µ –≤—Ä–µ–º–µ–Ω–µ–º

3. **–ù–µ –ª–æ–º–∞–µ—Ç –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä**:
   - `rawWidth` –≤—Å–µ–≥–¥–∞ –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
   - –ù–µ —É–ª–µ—Ç–∞–µ—Ç –≤ `MAX_CANDLE_PX`

---

## üéØ –ï–¥–∏–Ω—ã–π anchorTime

### –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∏—Å—Ç–æ—Ä–∏–∏ —á–µ—Ä–µ–∑ `prependCandles` –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è **–¥—Ä—É–≥–æ–π anchorTime**, —á–µ–º –ø—Ä–∏ `initializeFromSnapshot`:

```typescript
// ‚ùå –°–¢–ê–†–ê–Ø –†–ï–ê–õ–ò–ó–ê–¶–ò–Ø:

// initializeFromSnapshot:
const anchorTime = lastSnapshotCandle.endTime; // –ù–∞–ø—Ä–∏–º–µ—Ä, 30000

// prependCandles:
const firstExistingCandle = candlesRef.current[0];
const anchorTime = firstExistingCandle.startTime; // –ù–∞–ø—Ä–∏–º–µ—Ä, 15000

// –†–µ–∑—É–ª—å—Ç–∞—Ç: —Ä–∞–∑–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç ‚Üí —Å–≤–µ—á–∏ –Ω–∞–ª–∏–ø–∞—é—Ç –∏–ª–∏ —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è —Ä–µ–¥–∫–∏–º–∏
```

### –†–µ—à–µ–Ω–∏–µ: –µ–¥–∏–Ω—ã–π anchorTime –Ω–∞ –≤–µ—Å—å –∂–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –¢–§

**–§–∞–π–ª**: `frontend/components/chart/internal/useChartData.ts`

```typescript
// üî• –°–æ—Ö—Ä–∞–Ω—è–µ–º anchorTime –≤ ref
const anchorTimeRef = useRef<number | null>(null);

const initializeFromSnapshot = (/* ... */) => {
  // ...
  
  // üî• –°–æ—Ö—Ä–∞–Ω—è–µ–º anchorTime –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
  const anchorTime = lastSnapshotCandle.endTime;
  anchorTimeRef.current = anchorTime; // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–ª—è –≤—Å–µ–≥–æ –∂–∏–∑–Ω–µ–Ω–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ –¢–§
  
  // ...
};

const prependCandles = (newCandles: SnapshotCandle[], timeframeMs: number) => {
  // ...
  
  // üî• –ò—Å–ø–æ–ª—å–∑—É–µ–º –µ–¥–∏–Ω—ã–π anchorTime (—Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π –ø—Ä–∏ initializeFromSnapshot)
  // –ï—Å–ª–∏ anchorTime –µ—â–µ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω (–Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å, –Ω–æ –Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π)
  if (anchorTimeRef.current === null) {
    const lastExistingCandle = candlesRef.current[candlesRef.current.length - 1];
    anchorTimeRef.current = lastExistingCandle.endTime;
  }
  
  // –í—ã—á–∏—Å–ª—è–µ–º –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è –ø–µ—Ä–≤–æ–π –Ω–æ–≤–æ–π —Å–≤–µ—á–∏
  // –ù–æ–≤—ã–µ —Å–≤–µ—á–∏ –¥–æ–ª–∂–Ω—ã –∏–¥—Ç–∏ –ü–ï–†–ï–î —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ
  const firstExistingCandle = candlesRef.current[0];
  const firstNormalizedTime = firstExistingCandle.startTime - (uniqueNew.length * timeframeMs);
  
  // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º –Ω–æ–≤—ã–µ —Å–≤–µ—á–∏ –∏—Å–ø–æ–ª—å–∑—É—è —Ç–æ—Ç –∂–µ –≤—Ä–µ–º–µ–Ω–Ω–æ–π —à–∞–≥
  for (let i = 0; i < uniqueNew.length; i++) {
    const normalizedStartTime = firstNormalizedTime + i * timeframeMs;
    const normalizedEndTime = normalizedStartTime + timeframeMs;
    // ...
  }
  
  // ...
};

const reset = (): void => {
  // ...
  anchorTimeRef.current = null; // üî• –°–±—Ä–∞—Å—ã–≤–∞–µ–º anchorTime –¢–û–õ–¨–ö–û –ø—Ä–∏ —Å–º–µ–Ω–µ –¢–§
};
```

### –†–µ–∑—É–ª—å—Ç–∞—Ç

- **Snapshot –∏ history –∏—Å–ø–æ–ª—å–∑—É—é—Ç –µ–¥–∏–Ω—É—é —Å–∏—Å—Ç–µ–º—É –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç**
- **–ù–æ–≤—ã–µ —Å–≤–µ—á–∏ –Ω–µ –Ω–∞–ª–∏–ø–∞—é—Ç –∏ –Ω–µ —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è —Ä–µ–¥–∫–∏–º–∏**
- **Infinite scroll —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –Ω–∞ –≤—Å–µ—Ö –¢–§**
- **–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –¢–§ –∏ reload –¥–∞—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç**

---

## üîÑ –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è

### –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–æ–±—ã—Ç–∏–π (—Å hard reset —á–µ—Ä–µ–∑ React key)

```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∫–ª–∏–∫–∞–µ—Ç –Ω–∞ –∫–Ω–æ–ø–∫—É —Ç–∞–π–º—Ñ—Ä–µ–π–º–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "30s")
   ‚Üì
2. setTimeframe('30s') –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è
   ‚Üì
3. React –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–µ key={`${instrument}_${timeframe}`}
   ‚Üì
4. üî• HARD RESET: React –≤—ã–ø–æ–ª–Ω—è–µ—Ç –ø–æ–ª–Ω—ã–π unmount —Å—Ç–∞—Ä–æ–≥–æ –≥—Ä–∞—Ñ–∏–∫–∞:
   ‚îú‚îÄ‚îÄ –í—Å–µ refs —É–Ω–∏—á—Ç–æ–∂–∞—é—Ç—Å—è (GC)
   ‚îú‚îÄ‚îÄ –í—Å–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –æ—á–∏—â–∞—é—Ç—Å—è
   ‚îú‚îÄ‚îÄ –í—Å–µ —ç—Ñ—Ñ–µ–∫—Ç—ã –æ—Ç–º–µ–Ω—è—é—Ç—Å—è
   ‚îî‚îÄ‚îÄ –í—Å–µ –ø–æ–¥–ø–∏—Å–∫–∏ –æ—Ç–∫–ª—é—á–∞—é—Ç—Å—è
   ‚Üì
5. useTerminalSnapshot –ø–µ—Ä–µ–∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç snapshot —Å timeframe=30s
   ‚Üì
6. React –≤—ã–ø–æ–ª–Ω—è–µ—Ç mount –Ω–æ–≤–æ–≥–æ –≥—Ä–∞—Ñ–∏–∫–∞:
   ‚îú‚îÄ‚îÄ –°–æ–∑–¥–∞—é—Ç—Å—è –Ω–æ–≤—ã–µ refs (—á–∏—Å—Ç—ã–µ)
   ‚îú‚îÄ‚îÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É—é—Ç—Å—è –Ω–æ–≤—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
   ‚îú‚îÄ‚îÄ –ü–æ–¥–∫–ª—é—á–∞—é—Ç—Å—è –Ω–æ–≤—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã
   ‚îî‚îÄ‚îÄ –ù–µ—Ç –Ω–∏–∫–∞–∫–∏—Ö —Å—Ç–∞—Ä—ã—Ö —á–∏—Å–ª–æ–≤—ã—Ö –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–≤
   ‚Üì
7. –ù–æ–≤—ã–π snapshot –ø—Ä–∏—Ö–æ–¥–∏—Ç —Å —Å–µ—Ä–≤–µ—Ä–∞
   ‚Üì
8. chartData.initializeFromSnapshot() –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è (–ø–µ—Ä–≤—ã–π —Ä–∞–∑ –¥–ª—è –Ω–æ–≤–æ–≥–æ instance):
   ‚îú‚îÄ‚îÄ –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–∏ —Å–≤–µ—á–µ–π
   ‚îú‚îÄ‚îÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ anchorTime
   ‚îî‚îÄ‚îÄ –°–æ–∑–¥–∞–Ω–∏–µ live-—Å–≤–µ—á–∏
   ‚Üì
9. viewport.recalculateViewport() –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è (–ø–µ—Ä–≤—ã–π —Ä–∞–∑ –¥–ª—è –Ω–æ–≤–æ–≥–æ instance):
   ‚îú‚îÄ‚îÄ –í—ã—á–∏—Å–ª–µ–Ω–∏–µ visibleCandles —Å —É—á–µ—Ç–æ–º –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞ —Ç–∞–π–º—Ñ—Ä–µ–π–º–∞:
   ‚îÇ   baseVisible = canvasWidth / TARGET_CANDLE_PX
   ‚îÇ   timeframeMultiplier = timeframeMs / BASE_TIMEFRAME_MS
   ‚îÇ   visibleCandles = baseVisible * timeframeMultiplier
   ‚îú‚îÄ‚îÄ –í—ã—á–∏—Å–ª–µ–Ω–∏–µ timeRange = visibleCandles * timeframeMs
   ‚îú‚îÄ‚îÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ viewport –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ —Å–≤–µ—á–∏
   ‚îî‚îÄ‚îÄ Auto-fit –ø–æ Y
   ‚Üì
10. –ì—Ä–∞—Ñ–∏–∫ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —Å –Ω–æ–≤—ã–º —Ç–∞–π–º—Ñ—Ä–µ–π–º–æ–º (–∫–∞–∫ –ø—Ä–∏ reload —Å—Ç—Ä–∞–Ω–∏—Ü—ã)
   ‚Üì
11. –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∏—Å—Ç–æ—Ä–∏—è —á–µ—Ä–µ–∑ prependCandles
    (–∏—Å–ø–æ–ª—å–∑—É—è –µ–¥–∏–Ω—ã–π anchorTime)
```

### –í—Ä–µ–º–µ–Ω–Ω–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞ (—Å hard reset)

```
–í—Ä–µ–º—è ‚Üí
‚îÇ
‚îú‚îÄ [–ö–ª–∏–∫ –Ω–∞ "30s"]
‚îÇ
‚îú‚îÄ [setTimeframe('30s')]
‚îÇ
‚îú‚îÄ [React –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–µ key]
‚îÇ  ‚îÇ
‚îÇ  ‚îú‚îÄ üî• UNMOUNT —Å—Ç–∞—Ä–æ–≥–æ –≥—Ä–∞—Ñ–∏–∫–∞
‚îÇ  ‚îÇ  ‚îú‚îÄ –í—Å–µ refs —É–Ω–∏—á—Ç–æ–∂–∞—é—Ç—Å—è
‚îÇ  ‚îÇ  ‚îú‚îÄ –í—Å–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –æ—á–∏—â–∞—é—Ç—Å—è
‚îÇ  ‚îÇ  ‚îú‚îÄ –í—Å–µ —ç—Ñ—Ñ–µ–∫—Ç—ã –æ—Ç–º–µ–Ω—è—é—Ç—Å—è
‚îÇ  ‚îÇ  ‚îî‚îÄ GC –≤—Å–µ—Ö –æ–±—ä–µ–∫—Ç–æ–≤
‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ üî• MOUNT –Ω–æ–≤–æ–≥–æ –≥—Ä–∞—Ñ–∏–∫–∞
‚îÇ     ‚îú‚îÄ –°–æ–∑–¥–∞—é—Ç—Å—è –Ω–æ–≤—ã–µ refs (—á–∏—Å—Ç—ã–µ)
‚îÇ     ‚îú‚îÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É—é—Ç—Å—è –Ω–æ–≤—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
‚îÇ     ‚îî‚îÄ –ü–æ–¥–∫–ª—é—á–∞—é—Ç—Å—è –Ω–æ–≤—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã
‚îÇ
‚îú‚îÄ [API –∑–∞–ø—Ä–æ—Å: /terminal/snapshot?timeframe=30s]
‚îÇ
‚îú‚îÄ [Snapshot –ø–æ–ª—É—á–µ–Ω]
‚îÇ  ‚îÇ
‚îÇ  ‚îú‚îÄ chartData.initializeFromSnapshot() (–ø–µ—Ä–≤—ã–π —Ä–∞–∑)
‚îÇ  ‚îÇ  ‚îú‚îÄ –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–∏
‚îÇ  ‚îÇ  ‚îú‚îÄ anchorTime = lastCandle.endTime
‚îÇ  ‚îÇ  ‚îî‚îÄ –°–æ–∑–¥–∞–Ω–∏–µ live-—Å–≤–µ—á–∏
‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ viewport.recalculateViewport() (–ø–µ—Ä–≤—ã–π —Ä–∞–∑)
‚îÇ     ‚îú‚îÄ visibleCandles = (canvasWidth / TARGET_CANDLE_PX) * (timeframeMs / 5000)
‚îÇ     ‚îú‚îÄ timeRange = visibleCandles * timeframeMs
‚îÇ     ‚îî‚îÄ Auto-fit Y
‚îÇ
‚îî‚îÄ [–ì—Ä–∞—Ñ–∏–∫ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è (–∫–∞–∫ –ø—Ä–∏ reload)]
```

---

## üìù –ü—Ä–∏–º–µ—Ä—ã —Ä–∞–±–æ—Ç—ã

### –ü—Ä–∏–º–µ—Ä 1: –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ 5s ‚Üí 30s

**–ò—Å—Ö–æ–¥–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (5s)**:
- `canvasWidth = 1000px`
- `baseVisible = 1000 / 14 = 71.43`
- `timeframeMultiplier = 5000 / 5000 = 1`
- `visibleCandles = 71.43 * 1 = 71` (–æ–∫—Ä—É–≥–ª–µ–Ω–æ)
- `timeRange = 71 * 5000 = 355000ms` (5.9 –º–∏–Ω—É—Ç)
- `rawWidth = (5000 / 355000) * 1000 = 14.08px`
- `candleWidth = 14.08px` (–ø–æ—Å–ª–µ clamp)

**–ü–æ—Å–ª–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è (30s)**:
1. **Reset –≤—ã–ø–æ–ª–Ω–µ–Ω**: –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –æ—á–∏—â–µ–Ω—ã
2. **Snapshot –∑–∞–≥—Ä—É–∂–µ–Ω**: —Å–≤–µ—á–∏ –ø–æ 30 —Å–µ–∫—É–Ω–¥
3. **viewport –ø–µ—Ä–µ—Å—á–∏—Ç–∞–Ω**:
   - `baseVisible = 1000 / 14 = 71.43`
   - `timeframeMultiplier = 30000 / 5000 = 6` ‚Üê **–∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç!**
   - `visibleCandles = 71.43 * 6 = 428` (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–æ MAX_VISIBLE_CANDLES = 300)
   - `visibleCandles = 300` (–ø–æ—Å–ª–µ clamp)
   - `timeRange = 300 * 30000 = 9000000ms` (150 –º–∏–Ω—É—Ç = 2.5 —á–∞—Å–∞)
   - `rawWidth = (30000 / 9000000) * 1000 = 3.33px`
   - `effectiveMaxWidth = 3.33 - 0.5 = 2.83px`
   - `candleWidth = 2.83px` (–ø–æ—Å–ª–µ clamp)

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: 
- ‚úÖ Viewport –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ "–æ—Ç–æ–¥–≤–∏–Ω—É–ª—Å—è –Ω–∞–∑–∞–¥" (300 —Å–≤–µ—á–µ–π –≤–º–µ—Å—Ç–æ 71)
- ‚úÖ –í–∏–∑—É–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Å–≤–µ—á–µ–π –ø—Ä–∏–º–µ—Ä–Ω–æ –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π (~14px –¥–ª—è 5s, ~3px –¥–ª—è 30s –ø—Ä–∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–º zoom out)
- ‚úÖ –ü—Ä–∏ –æ–¥–∏–Ω–∞–∫–æ–≤–æ–º zoom level —Å–≤–µ—á–∏ –±—É–¥—É—Ç –æ–¥–∏–Ω–∞–∫–æ–≤–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞

### –ü—Ä–∏–º–µ—Ä 2: Zoom –Ω–∞ —Ä–∞–∑–Ω—ã—Ö –¢–§

**5s —Ç–∞–π–º—Ñ—Ä–µ–π–º**:
- –¢–µ–∫—É—â–µ–µ: `visibleCandles = 60`
- Zoom in (wheel up): `visibleCandles = 60 - 3 = 57`
- Zoom out (wheel down): `visibleCandles = 60 + 3 = 63`

**30s —Ç–∞–π–º—Ñ—Ä–µ–π–º**:
- –¢–µ–∫—É—â–µ–µ: `visibleCandles = 20`
- Zoom in (wheel up): `visibleCandles = 20 - 3 = 17`
- Zoom out (wheel down): `visibleCandles = 20 + 3 = 23`

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –û–¥–∏–Ω–∞–∫–æ–≤–æ–µ –æ—â—É—â–µ–Ω–∏–µ zoom (¬±3 —Å–≤–µ—á–∏), –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –¢–§.

### –ü—Ä–∏–º–µ—Ä 3: Infinite scroll —Å –µ–¥–∏–Ω—ã–º anchorTime

**–ò—Å—Ö–æ–¥–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ**:
- Snapshot –∑–∞–≥—Ä—É–∂–µ–Ω: —Å–≤–µ—á–∏ —Å `normalizedStartTime = 15000` –¥–æ `normalizedEndTime = 30000`
- `anchorTime = 30000`

**–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–æ–∫—Ä—É—Ç–∏–ª –≤–ª–µ–≤–æ**:
- `prependCandles` –∑–∞–≥—Ä—É–∂–∞–µ—Ç –Ω–æ–≤—ã–µ —Å–≤–µ—á–∏
- –ù–æ–≤—ã–µ —Å–≤–µ—á–∏ –Ω–æ—Ä–º–∞–ª–∏–∑—É—é—Ç—Å—è: `normalizedStartTime = 10000` –¥–æ `normalizedEndTime = 15000`
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ—Ç –∂–µ `anchorTime = 30000` (–Ω–µ –º–µ–Ω—è–µ—Ç—Å—è!)

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –ù–æ–≤—ã–µ —Å–≤–µ—á–∏ –∏–¥—É—Ç –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ –ø–µ—Ä–µ–¥ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏, –±–µ–∑ –Ω–∞–ª–∏–ø–∞–Ω–∏—è.

---

## üîë –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã

### 1. –ë–∞–∑–æ–≤—ã–π —Ç–∞–π–º—Ñ—Ä–µ–π–º = –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã

- –¢–æ–ª—å–∫–æ `5s` —Å–≤–µ—á–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –∏–∑ —Ç–∏–∫–æ–≤ —Ü–µ–Ω—ã
- –í—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ç–∞–π–º—Ñ—Ä–µ–π–º—ã –∞–≥—Ä–µ–≥–∏—Ä—É—é—Ç—Å—è –∏–∑ `5s`
- –≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö

### 2. Hard reset —á–µ—Ä–µ–∑ React key –ø—Ä–∏ —Å–º–µ–Ω–µ –¢–§

- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `key={`${instrument}_${timeframe}`}` –Ω–∞ `ChartContainer`
- React –≤—ã–ø–æ–ª–Ω—è–µ—Ç –ø–æ–ª–Ω—ã–π unmount/mount –ø—Ä–∏ —Å–º–µ–Ω–µ –¢–§
- –ù–µ —Å–æ—Ö—Ä–∞–Ω—è–µ–º zoom/pan –º–µ–∂–¥—É –¢–§
- –ö–∞–∂–¥—ã–π –¢–§ = –Ω–æ–≤—ã–π –≤—Ä–µ–º–µ–Ω–Ω–æ–π –º–∏—Ä (–Ω–æ–≤—ã–π chart instance)
- –≠—Ç–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã –∏ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è
- –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –ø–æ–ª–Ω—ã–π reset –∫–∞–∫ –ø—Ä–∏ reload —Å—Ç—Ä–∞–Ω–∏—Ü—ã

### 3. –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–∏

- –í—Å–µ —Å–≤–µ—á–∏ –Ω–æ—Ä–º–∞–ª–∏–∑—É—é—Ç—Å—è –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –µ–¥–∏–Ω–æ–≥–æ `anchorTime`
- –≠—Ç–æ —É—Å—Ç—Ä–∞–Ω—è–µ—Ç –≤–∏–∑—É–∞–ª—å–Ω—ã–µ –¥—ã—Ä–∫–∏ –Ω–∞ –≥—Ä–∞—Ñ–∏–∫–µ
- `anchorTime` –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è –≤ —Ç–µ—á–µ–Ω–∏–µ –∂–∏–∑–Ω–µ–Ω–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ –¢–§

### 4. Zoom —á–µ—Ä–µ–∑ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–≤–µ—á–µ–π

- Zoom —É–ø—Ä–∞–≤–ª—è–µ—Ç –ø–ª–æ—Ç–Ω–æ—Å—Ç—å—é —Å–≤–µ—á–µ–π, –∞ –Ω–µ –≤—Ä–µ–º–µ–Ω–µ–º
- –≠—Ç–æ –¥–∞–µ—Ç –æ–¥–∏–Ω–∞–∫–æ–≤–æ–µ –æ—â—É—â–µ–Ω–∏–µ –Ω–∞ –≤—Å–µ—Ö –¢–§
- –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç "–∑–∞–ª–∏–ø–∞–Ω–∏–µ" —Ä–∞–∑–º–µ—Ä–∞ —Å–≤–µ—á–µ–π

### 5. Timeframe-aware visibleCandles (—Å –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–º —Ç–∞–π–º—Ñ—Ä–µ–π–º–∞)

**–ö–ª—é—á–µ–≤–æ–π –ø—Ä–∏–Ω—Ü–∏–ø**: –¢–∞–π–º—Ñ—Ä–µ–π–º –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç "–º–∞—Å—à—Ç–∞–± –º–∏—Ä–∞", zoom ‚Äî —Å–∫–æ–ª—å–∫–æ —ç—Ç–æ–≥–æ –º–∏—Ä–∞ –≤–∏–¥–Ω–æ.

- `visibleCandles` –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è —Å —É—á–µ—Ç–æ–º –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞ —Ç–∞–π–º—Ñ—Ä–µ–π–º–∞:
  ```typescript
  baseVisible = canvasWidth / TARGET_CANDLE_PX
  timeframeMultiplier = timeframeMs / BASE_TIMEFRAME_MS  // BASE_TIMEFRAME_MS = 5000
  visibleCandles = baseVisible * timeframeMultiplier
  ```
  
**–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç**:
- **5s**: `multiplier = 1` ‚Üí –≤–∏–¥–∏–º –±–∞–∑–æ–≤–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–≤–µ—á–µ–π
- **30s**: `multiplier = 6` ‚Üí –≤–∏–¥–∏–º –≤ 6 —Ä–∞–∑ –±–æ–ª—å—à–µ —Å–≤–µ—á–µ–π (viewport "–æ—Ç–æ–¥–≤–∏–≥–∞–µ—Ç—Å—è –Ω–∞–∑–∞–¥")
- **1m**: `multiplier = 12` ‚Üí –≤–∏–¥–∏–º –≤ 12 —Ä–∞–∑ –±–æ–ª—å—à–µ —Å–≤–µ—á–µ–π (–µ—â–µ –¥–∞–ª—å—à–µ)

**–†–µ–∑—É–ª—å—Ç–∞—Ç**:
- ‚úÖ –û–¥–∏–Ω–∞–∫–æ–≤–∞—è –≤–∏–∑—É–∞–ª—å–Ω–∞—è —à–∏—Ä–∏–Ω–∞ —Å–≤–µ—á–µ–π –Ω–∞ –≤—Å–µ—Ö –¢–§ –ø—Ä–∏ –æ–¥–∏–Ω–∞–∫–æ–≤–æ–º zoom level
- ‚úÖ –ë–æ–ª—å—à–∏–µ –¢–§ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å—Ç–∞—Ä—Ç—É—é—Ç —Å –±–æ–ª—å—à–∏–º `visibleCandles`
- ‚úÖ –≠—Ç–æ —Ñ–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç –º–µ—Ç–∞—Ñ–æ—Ä—É "–¥–µ—Ä–µ–≤–æ —Å—Ç–∞–ª–æ –±–æ–ª—å—à–µ ‚Äî –º—ã –æ—Ç–æ—à–ª–∏ –Ω–∞–∑–∞–¥"

---

## üìö –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### –ë—ç–∫–µ–Ω–¥

- `backend/src/prices/PriceTypes.ts` - —Ç–∏–ø—ã —Ç–∞–π–º—Ñ—Ä–µ–π–º–æ–≤
- `backend/src/prices/engines/TimeframeAggregator.ts` - –∞–≥—Ä–µ–≥–∞—Ü–∏—è —Å–≤–µ—á–µ–π
- `backend/src/prices/PriceEngineManager.ts` - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∞–≥—Ä–µ–≥–∞—Ü–∏–∏
- `backend/src/modules/terminal/terminal.controller.ts` - API endpoints
- `backend/src/modules/terminal/terminal.schema.ts` - –≤–∞–ª–∏–¥–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤
- `backend/src/infrastructure/terminal/TerminalSnapshotAdapter.ts` - –∞–¥–∞–ø—Ç–µ—Ä snapshot

### –§—Ä–æ–Ω—Ç–µ–Ω–¥

- `frontend/app/terminal/page.tsx` - UI –≤—ã–±–æ—Ä–∞ —Ç–∞–π–º—Ñ—Ä–µ–π–º–æ–≤
- `frontend/components/chart/useChart.ts` - –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä –≥—Ä–∞—Ñ–∏–∫–∞
- `frontend/components/chart/internal/useChartData.ts` - –¥–∞–Ω–Ω—ã–µ —Å–≤–µ—á–µ–π –∏ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è
- `frontend/components/chart/internal/useViewport.ts` - viewport –∏ reset
- `frontend/components/chart/internal/interactions/useChartInteractions.ts` - –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è
- `frontend/components/chart/internal/interactions/math.ts` - zoom —á–µ—Ä–µ–∑ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–≤–µ—á–µ–π
- `frontend/components/chart/internal/utils/timeframe.ts` - —É—Ç–∏–ª–∏—Ç—ã –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞

---

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã

–ì—Ä–∞—Ñ–∏–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ, –µ—Å–ª–∏:

- ‚úÖ –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –¢–§ –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ—Å–æ–∑–¥–∞–µ—Ç –≥—Ä–∞—Ñ–∏–∫ —á–µ—Ä–µ–∑ React key (–∫–∞–∫ reload —Å—Ç—Ä–∞–Ω–∏—Ü—ã)
- ‚úÖ –ù–µ—Ç —Å—Ç–∞—Ä—ã—Ö —á–∏—Å–ª–æ–≤—ã—Ö –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–≤ (wheel deltas, anchorRatio, RAF timing)
- ‚úÖ Viewport —Å–æ–∑–¥–∞–µ—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑ –ø–æ–¥ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π timeframe
- ‚úÖ –í–∏–∑—É–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Å–≤–µ—á–µ–π –ø—Ä–∏–º–µ—Ä–Ω–æ –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π –Ω–∞ –≤—Å–µ—Ö –¢–§ (–±–ª–∞–≥–æ–¥–∞—Ä—è –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—É)
- ‚úÖ Zoom —Ä–∞–±–æ—Ç–∞–µ—Ç –æ–¥–∏–Ω–∞–∫–æ–≤–æ –Ω–∞ –≤—Å–µ—Ö –¢–§ (¬±3 —Å–≤–µ—á–∏ –∑–∞ —à–∞–≥)
- ‚úÖ Snapshot –∏ history —Å–≤–µ—á–∏ –≤—ã–≥–ª—è–¥—è—Ç –æ–¥–∏–Ω–∞–∫–æ–≤–æ (–Ω–µ –Ω–∞–ª–∏–ø–∞—é—Ç, –Ω–µ —Ä–µ–¥–∫–∏–µ)
- ‚úÖ Infinite scroll —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –Ω–∞ –≤—Å–µ—Ö –¢–§
- ‚úÖ Follow mode –≤–∫–ª—é—á–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ—Å–ª–µ —Å–º–µ–Ω—ã –¢–§
- ‚úÖ –ù–µ—Ç –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤ –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–º—É –¢–§
- ‚úÖ –í—Å–µ —Ç–∞–π–º—Ñ—Ä–µ–π–º—ã –∞–≥—Ä–µ–≥–∏—Ä—É—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∏–∑ –±–∞–∑–æ–≤—ã—Ö 5s —Å–≤–µ—á–µ–π

---

## üêõ –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞: –°–≤–µ—á–∏ –Ω–∞–ª–∏–ø–∞—é—Ç –ø–æ—Å–ª–µ infinite scroll

**–ü—Ä–∏—á–∏–Ω–∞**: –†–∞–∑–Ω—ã–µ `anchorTime` –¥–ª—è snapshot –∏ history

**–†–µ—à–µ–Ω–∏–µ**: –ï–¥–∏–Ω—ã–π `anchorTime` –Ω–∞ –≤–µ—Å—å –∂–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –¢–§ (—Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ)

### –ü—Ä–æ–±–ª–µ–º–∞: Zoom "–ª–æ–º–∞–µ—Ç" —Ä–∞–∑–º–µ—Ä —Å–≤–µ—á–µ–π –Ω–∞ –±–æ–ª—å—à–∏—Ö –¢–§

**–ü—Ä–∏—á–∏–Ω–∞**: Zoom —Ä–∞–±–æ—Ç–∞–ª —á–µ—Ä–µ–∑ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥—ã, –∞ –Ω–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–≤–µ—á–µ–π

**–†–µ—à–µ–Ω–∏–µ**: Zoom —á–µ—Ä–µ–∑ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–≤–µ—á–µ–π (—Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ)

### –ü—Ä–æ–±–ª–µ–º–∞: –†–∞–∑–Ω—ã–π –≤–∏–∑—É–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Å–≤–µ—á–µ–π –Ω–∞ —Ä–∞–∑–Ω—ã—Ö –¢–§

**–ü—Ä–∏—á–∏–Ω–∞**: –°–º–µ—à–∏–≤–∞–Ω–∏–µ time-based –º–æ–¥–µ–ª–∏ (viewport = timeStart/timeEnd) —Å pixel-based –æ–∂–∏–¥–∞–Ω–∏–µ–º (–æ–¥–∏–Ω–∞–∫–æ–≤–∞—è —à–∏—Ä–∏–Ω–∞ —Å–≤–µ—á–µ–π)

**–†–µ—à–µ–Ω–∏–µ**: `visibleCandles = (canvasWidth / TARGET_CANDLE_PX) * (timeframeMs / BASE_TIMEFRAME_MS)` (—Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ)

**–°—É—Ç—å —Ä–µ—à–µ–Ω–∏—è**: –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç —Ç–∞–π–º—Ñ—Ä–µ–π–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ "–æ—Ç–æ–¥–≤–∏–≥–∞–µ—Ç" viewport –Ω–∞–∑–∞–¥ –¥–ª—è –±–æ–ª—å—à–∏—Ö –¢–§, —Å–æ—Ö—Ä–∞–Ω—è—è –æ–¥–∏–Ω–∞–∫–æ–≤—É—é –≤–∏–∑—É–∞–ª—å–Ω—É—é –ø–ª–æ—Ç–Ω–æ—Å—Ç—å —Å–≤–µ—á–µ–π.

---

## üìñ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- `CANDLE_DISPLAY_PARAMETERS.md` - –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–≤–µ—á–µ–π
- `GRAPH_CURRENT_ARCHITECTURE.md` - –æ–±—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –≥—Ä–∞—Ñ–∏–∫–∞
- `FRONTEND_STRUCTURE.md` - —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
- `BACKEND_ARCHITECTURE.md` - —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –±—ç–∫–µ–Ω–¥–∞

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: 2026-01-29
